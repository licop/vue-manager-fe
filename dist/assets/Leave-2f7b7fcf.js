import{_ as z,k as B,r as F,b as T,l as O,e as i,o as S,c as L,f as p,g as e,w as t,m as w,i as c,F as R,n as E,p as A,q as I,t as f}from"./index-b737c2d7.js";const j={name:"leave",setup(){const{proxy:u}=B(),o=F({applyState:""}),b=F({pageNum:1,pageSize:10,total:0}),a=F([{label:"单号",prop:"orderNo"},{label:"休假时间",prop:"",formatter(n){return w.formateDate(new Date(n.startTime),"yyyy-MM-dd")+"到"+w.formateDate(new Date(n.endTime),"yyyy-MM-dd")}},{label:"休假时长",prop:"leaveTime"},{label:"休假类型",prop:"applyType",formatter(n,l,d){return{1:"事假",2:"调休",3:"年假"}[d]}},{label:"休假原因",prop:"reasons"},{label:"申请时间",prop:"createTime",width:180,formatter:(n,l,d)=>w.formateDate(new Date(d))},{label:"审批人",prop:"auditUsers"},{label:"当前审批人",prop:"curAuditUserName"},{label:"审批状态",prop:"applyState",formatter:(n,l,d)=>({1:"待审批",2:"审批中",3:"审批拒绝",4:"审批通过",5:"作废"})[d]}]),q=T([]),_=F({applyType:1,startTime:"",endTime:"",leaveTime:"0天",reasons:""}),s=T("create"),v=T(!1),r=T(!1);let m=T({});const h={startTime:[{type:"date",required:!0,message:"请输入开始日期",trigger:"change"}],endTime:[{type:"date",required:!0,message:"请输入结束日期",trigger:"change"}],reasons:[{required:!0,message:"请输入休假原因",trigger:["change","blur"]}]};O(()=>{y()});const y=async()=>{let n={...o,...b},{list:l,page:d}=await u.$api.getApplyList(n);q.value=l,b.total=d.total},C=n=>{u.$refs[n].resetFields()},M=n=>{b.pageNum=n,getUserList()},V=()=>{v.value=!0,s.value="create"},g=()=>{v.value=!1,C("dialogForm")};return{queryForm:o,pager:b,columns:a,handleCurrentChange:M,handleReset:C,getApplyList:y,applyList:q,leaveForm:_,showModal:v,showDetailModal:r,handleApply:V,handleClose:g,handleSubmit:()=>{u.$refs.dialogForm.validate(async n=>{if(n)try{let l={..._,action:s.value},d=await u.$api.leaveOperate(l);u.$message.success("创建成功"),g(),y()}catch{}})},rules:h,handleDateChange:(n,l)=>{let{startTime:d,endTime:k}=_;console.log(d,k,321,n),!(!d||!k)&&(d>k?(u.$message.error("开始日期不能晚于结束日期"),_.leaveTime="0天",setTimeout(()=>{_[n]=""},0)):_.leaveTime=(k-d)/(24*60*60*1e3)+1+"天")},detail:m,handleDetail:n=>{let l={...n};l.applyTypeName={1:"事假",2:"调休",3:"年假"}[l.applyType],l.time=w.formateDate(new Date(l.startTime),"yyyy-MM-dd")+"到"+w.formateDate(new Date(l.endTime),"yyyy-MM-dd"),l.applyStateName={1:"待审批",2:"审批中",3:"审批拒绝",4:"审批通过",5:"作废"}[l.applyState],m.value=l,r.value=!0},handleDelete:async n=>{try{let l={_id:n,action:"delete"},d=await u.$api.leaveOperate(l);u.$message.success("删除成功"),y()}catch{}}}}},G={class:"leave-manage"},H={class:"query-form"},J={class:"base-table"},K={class:"action"},P={class:"dialog-footer"};function Q(u,o,b,a,q,_){const s=i("el-option"),v=i("el-select"),r=i("el-form-item"),m=i("el-button"),h=i("el-form"),y=i("el-table-column"),C=i("el-table"),M=i("el-pagination"),V=i("el-date-picker"),g=i("el-col"),N=i("el-row"),U=i("el-input"),x=i("el-dialog"),D=i("el-step"),n=i("el-steps");return S(),L("div",G,[p("div",H,[e(h,{ref:"form",inline:!0,model:a.queryForm},{default:t(()=>[e(r,{label:"审批状态",prop:"applyState"},{default:t(()=>[e(v,{modelValue:a.queryForm.applyState,"onUpdate:modelValue":o[0]||(o[0]=l=>a.queryForm.applyState=l)},{default:t(()=>[e(s,{value:"",label:"全部"}),e(s,{value:1,label:"待审批"}),e(s,{value:2,label:"审批中"}),e(s,{value:3,label:"审批拒绝"}),e(s,{value:4,label:"审批通过"}),e(s,{value:5,label:"作废"})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(m,{type:"primary",onClick:a.getApplyList},{default:t(()=>[c("查询")]),_:1},8,["onClick"]),e(m,{onClick:o[1]||(o[1]=l=>a.handleReset("form"))},{default:t(()=>[c("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),p("div",J,[p("div",K,[e(m,{type:"primary",onClick:a.handleApply},{default:t(()=>[c("申请休假")]),_:1},8,["onClick"])]),e(C,{data:a.applyList},{default:t(()=>[(S(!0),L(R,null,E(a.columns,l=>(S(),A(y,{key:l.prop,prop:l.prop,label:l.label,width:l.width,formatter:l.formatter},null,8,["prop","label","width","formatter"]))),128)),e(y,{label:"操作",width:"150"},{default:t(l=>[e(m,{type:"text",size:"small",onClick:d=>a.handleDetail(l.row)},{default:t(()=>[c("查看")]),_:2},1032,["onClick"]),[1,2].includes(l.row.applyState)?(S(),A(m,{key:0,type:"text",size:"small",onClick:d=>a.handleDelete(l.row._id)},{default:t(()=>[c("作废")]),_:2},1032,["onClick"])):I("",!0)]),_:1})]),_:1},8,["data"]),e(M,{class:"pagination",background:"",layout:"prev, pager, next",total:a.pager.total,"page-size":a.pager.pageSize,onCurrentChange:a.handleCurrentChange},null,8,["total","page-size","onCurrentChange"])]),e(x,{title:"申请休假",modelValue:a.showModal,"onUpdate:modelValue":o[8]||(o[8]=l=>a.showModal=l),width:"70%"},{footer:t(()=>[p("span",P,[e(m,{onClick:a.handleClose},{default:t(()=>[c("取 消")]),_:1},8,["onClick"]),e(m,{type:"primary",onClick:a.handleSubmit},{default:t(()=>[c("确 定")]),_:1},8,["onClick"])])]),default:t(()=>[e(h,{ref:"dialogForm",model:a.leaveForm,"label-width":"120px",rules:a.rules},{default:t(()=>[e(r,{label:"休假类型",prop:"applyType",required:""},{default:t(()=>[e(v,{modelValue:a.leaveForm.applyType,"onUpdate:modelValue":o[2]||(o[2]=l=>a.leaveForm.applyType=l)},{default:t(()=>[e(s,{label:"事假",value:1}),e(s,{label:"调休",value:2}),e(s,{label:"年假",value:3})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"休假时间",required:""},{default:t(()=>[e(N,null,{default:t(()=>[e(g,{span:8},{default:t(()=>[e(r,{prop:"startTime",required:""},{default:t(()=>[e(V,{modelValue:a.leaveForm.startTime,"onUpdate:modelValue":o[3]||(o[3]=l=>a.leaveForm.startTime=l),type:"date",placeholder:"选择开始日期",onChange:o[4]||(o[4]=l=>a.handleDateChange("startTime",l))},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{span:1},{default:t(()=>[c("-")]),_:1}),e(g,{span:8},{default:t(()=>[e(r,{prop:"endTime",required:""},{default:t(()=>[e(V,{modelValue:a.leaveForm.endTime,"onUpdate:modelValue":o[5]||(o[5]=l=>a.leaveForm.endTime=l),type:"date",placeholder:"选择结束日期",onChange:o[6]||(o[6]=l=>a.handleDateChange("endTime",l))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(r,{label:"休假时长",required:""},{default:t(()=>[c(f(a.leaveForm.leaveTime),1)]),_:1}),e(r,{label:"休假原因",prop:"reasons",required:""},{default:t(()=>[e(U,{type:"textarea",row:3,placeholder:"请输入休假原因",modelValue:a.leaveForm.reasons,"onUpdate:modelValue":o[7]||(o[7]=l=>a.leaveForm.reasons=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),e(x,{title:"申请休假详情",width:"50%",modelValue:a.showDetailModal,"onUpdate:modelValue":o[9]||(o[9]=l=>a.showDetailModal=l),"destroy-on-close":""},{default:t(()=>[e(n,{active:a.detail.applyState>2?3:a.detail.applyState,"align-center":""},{default:t(()=>[e(D,{title:"待审批"}),e(D,{title:"审批中"}),e(D,{title:"审批通过/审批拒绝"})]),_:1},8,["active"]),e(h,{"label-width":"120px","label-suffix":":"},{default:t(()=>[e(r,{label:"休假类型"},{default:t(()=>[p("div",null,f(a.detail.applyTypeName),1)]),_:1}),e(r,{label:"休假时间"},{default:t(()=>[p("div",null,f(a.detail.time),1)]),_:1}),e(r,{label:"休假时长"},{default:t(()=>[p("div",null,f(a.detail.leaveTime),1)]),_:1}),e(r,{label:"休假原因"},{default:t(()=>[p("div",null,f(a.detail.reasons),1)]),_:1}),e(r,{label:"审批状态"},{default:t(()=>[p("div",null,f(a.detail.applyStateName),1)]),_:1}),e(r,{label:"审批人"},{default:t(()=>[p("div",null,f(a.detail.curAuditUserName),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const X=z(j,[["render",Q]]);export{X as default};
