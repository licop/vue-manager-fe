import{_ as S,k as x,r as v,b as T,l as U,e as p,o as C,c as A,f as s,g as l,w as t,m as b,i as g,F as q,n as L,p as M,q as z,t as c}from"./index-b737c2d7.js";const B={name:"approve",setup(){const{proxy:i}=x(),r=v({applyState:""}),y=v({pageNum:1,pageSize:10,total:0}),a=v([{label:"单号",prop:"orderNo"},{label:"申请人",prop:"",formatter(e){return e.applyUser.userName}},{label:"休假时间",prop:"",formatter(e){return b.formateDate(new Date(e.startTime),"yyyy-MM-dd")+"到"+b.formateDate(new Date(e.endTime),"yyyy-MM-dd")}},{label:"休假时长",prop:"leaveTime"},{label:"休假类型",prop:"applyType",formatter(e,o,m){return{1:"事假",2:"调休",3:"年假"}[m]}},{label:"休假原因",prop:"reasons"},{label:"申请时间",prop:"createTime",width:180,formatter:(e,o,m)=>b.formateDate(new Date(m))},{label:"审批人",prop:"auditUsers"},{label:"当前审批人",prop:"curAuditUserName"},{label:"审批状态",prop:"applyState",formatter:(e,o,m)=>({1:"待审批",2:"审批中",3:"审批拒绝",4:"审批通过",5:"作废"})[m]}]),k=T([]);v({applyType:1,startTime:"",endTime:"",leaveTime:"0天",reasons:""});const w=T(!1);let d=T({});const N=i.$store.state.userInfo,n={remark:[{required:!0,message:"请输入审核备注",trigger:"change"}]},u=v({remark:""});U(()=>{f()});const f=async()=>{let e={...r,...y,type:"approve"},{list:o,page:m}=await i.$api.getApplyList(e);k.value=o,y.total=m.total},_=e=>{i.$refs[e].resetFields()},D=e=>{y.pageNum=e,getUserList()},h=()=>{w.value=!1,_("dialogForm")};return{queryForm:r,pager:y,columns:a,handleCurrentChange:D,handleReset:_,getApplyList:f,applyList:k,auditForm:u,showDetailModal:w,handleClose:h,rules:n,detail:d,userInfo:N,handleDetail:e=>{let o={...e};o.applyTypeName={1:"事假",2:"调休",3:"年假"}[o.applyType],o.time=b.formateDate(new Date(o.startTime),"yyyy-MM-dd")+"到"+b.formateDate(new Date(o.endTime),"yyyy-MM-dd"),o.applyStateName={1:"待审批",2:"审批中",3:"审批拒绝",4:"审批通过",5:"作废"}[o.applyState],d.value=o,w.value=!0},handleApprove:e=>{i.$refs.dialogForm.validate(async o=>{if(o){let m={action:e,remark:u.remark,_id:d.value._id};try{await i.$api.leaveApprove(m),h(),i.$message.success("处理成功"),f(),i.$store.commit("saveNoticeCount",i.$store.state.noticeCount-1)}catch{}}})}}}},I={class:"approve-manage"},R={class:"query-form"},E={class:"base-table"},j=s("div",{class:"action"},null,-1),G={class:"dialog-footer"};function H(i,r,y,a,k,w){const d=p("el-option"),N=p("el-select"),n=p("el-form-item"),u=p("el-button"),f=p("el-form"),_=p("el-table-column"),D=p("el-table"),h=p("el-pagination"),F=p("el-input"),V=p("el-dialog");return C(),A("div",I,[s("div",R,[l(f,{ref:"form",inline:!0,model:a.queryForm},{default:t(()=>[l(n,{label:"审批状态",prop:"applyState"},{default:t(()=>[l(N,{modelValue:a.queryForm.applyState,"onUpdate:modelValue":r[0]||(r[0]=e=>a.queryForm.applyState=e)},{default:t(()=>[l(d,{value:"",label:"全部"}),l(d,{value:1,label:"待审批"}),l(d,{value:2,label:"审批中"}),l(d,{value:3,label:"审批拒绝"}),l(d,{value:4,label:"审批通过"}),l(d,{value:5,label:"作废"})]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(u,{type:"primary",onClick:a.getApplyList},{default:t(()=>[g("查询")]),_:1},8,["onClick"]),l(u,{onClick:r[1]||(r[1]=e=>a.handleReset("form"))},{default:t(()=>[g("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),s("div",E,[j,l(D,{data:a.applyList},{default:t(()=>[(C(!0),A(q,null,L(a.columns,e=>(C(),M(_,{key:e.prop,prop:e.prop,label:e.label,width:e.width,formatter:e.formatter},null,8,["prop","label","width","formatter"]))),128)),l(_,{label:"操作",width:"150"},{default:t(e=>[e.row.curAuditUserName==a.userInfo.userName&&[1,2].includes(e.row.applyState)?(C(),M(u,{key:0,type:"text",size:"small",onClick:o=>a.handleDetail(e.row)},{default:t(()=>[g("审核")]),_:2},1032,["onClick"])):z("",!0)]),_:1})]),_:1},8,["data"]),l(h,{class:"pagination",background:"",layout:"prev, pager, next",total:a.pager.total,"page-size":a.pager.pageSize,onCurrentChange:a.handleCurrentChange},null,8,["total","page-size","onCurrentChange"])]),l(V,{title:"审核",width:"50%",modelValue:a.showDetailModal,"onUpdate:modelValue":r[5]||(r[5]=e=>a.showDetailModal=e),"destroy-on-close":""},{footer:t(()=>[s("span",G,[l(u,{onClick:r[3]||(r[3]=e=>a.handleApprove("pass"))},{default:t(()=>[g("审核通过")]),_:1}),l(u,{onClick:r[4]||(r[4]=e=>a.handleApprove("refuse")),type:"primary"},{default:t(()=>[g("驳回")]),_:1})])]),default:t(()=>[l(f,{ref:"dialogForm",model:a.auditForm,"label-width":"120px","label-suffix":":",rules:a.rules},{default:t(()=>[l(n,{label:"申请人"},{default:t(()=>[s("div",null,c(a.detail.applyUser.userName),1)]),_:1}),l(n,{label:"休假类型"},{default:t(()=>[s("div",null,c(a.detail.applyTypeName),1)]),_:1}),l(n,{label:"休假时间"},{default:t(()=>[s("div",null,c(a.detail.time),1)]),_:1}),l(n,{label:"休假时长"},{default:t(()=>[s("div",null,c(a.detail.leaveTime),1)]),_:1}),l(n,{label:"休假原因"},{default:t(()=>[s("div",null,c(a.detail.reasons),1)]),_:1}),l(n,{label:"审批状态"},{default:t(()=>[s("div",null,c(a.detail.applyStateName),1)]),_:1}),l(n,{label:"审批人"},{default:t(()=>[s("div",null,c(a.detail.curAuditUserName),1)]),_:1}),l(n,{label:"备注",prop:"remark"},{default:t(()=>[l(F,{type:"textarea",rows:3,placeholder:"请输入审核备注",modelValue:a.auditForm.remark,"onUpdate:modelValue":r[2]||(r[2]=e=>a.auditForm.remark=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const O=S(B,[["render",H]]);export{O as default};
