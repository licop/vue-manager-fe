import{_ as q,m as V,e as r,s as E,o as d,c as g,f as _,g as s,w as o,v as b,p as c,i as u,F as v,n as C,x as I}from"./index-b737c2d7.js";const M={name:"dept",data(){return{queryForm:{deptName:""},columns:[{label:"部门名称",prop:"deptName"},{label:"负责人",prop:"userName"},{label:"更新时间",prop:"updateTime",formatter(a,t,p){return V.formateDate(new Date(p))}},{label:"创建时间",prop:"createTime",formatter(a,t,p){return V.formateDate(new Date(p))}}],deptList:[],pager:{pageNum:1,pageSize:10},action:"create",showModal:!1,deptForm:{parentId:[null]},userList:[],rules:{parentId:[{required:!0,message:"请选择上级部门",trigger:"blur"}],deptName:[{required:!0,message:"请输入部门名称",trigger:"blur"}],user:[{required:!0,message:"请选择负责人",trigger:"blur"}]}}},mounted(){this.getDeptList(),this.getAllUserList()},methods:{async getDeptList(){let a=await this.$api.getDeptList(this.queryForm);this.deptList=a},async getAllUserList(){this.userList=await this.$api.getAllUserList()},handleReset(a){console.log(a,192),this.$refs[a].resetFields()},handleUser(a){const[t,p,y]=a.split("/");Object.assign(this.deptForm,{userId:t,userName:p,userEmail:y})},handleOpen(){this.action="create",this.showModal=!0},handleEdit(a){this.action="edit",this.showModal=!0,this.$nextTick(()=>{Object.assign(this.deptForm,a,{user:`${a.userId}/${a.userName}/${a.userEmail}`})})},async handleDel(a){this.action="delete",await this.$api.deptOperate({_id:a,action:this.action}),this.$message.success("删除成功"),this.getDeptList()},handleClose(){this.showModal=!1,this.handleReset("dialogForm")},handleSubmit(){this.$refs.dialogForm.validate(async a=>{if(a){let t={...this.deptForm,action:this.action};delete t.user,await this.$api.deptOperate(t),this.$message.success("操作成功"),this.handleClose(),this.getDeptList()}})}}},O={class:"dept-manage"},B={class:"query-form"},S={class:"base-table"},T={class:"action"},z={class:"dialog-footer"};function A(a,t,p,y,l,n){const h=r("el-input"),m=r("el-form-item"),i=r("el-button"),F=r("el-form"),k=r("el-table-column"),w=r("el-table"),N=r("el-cascader"),L=r("el-option"),D=r("el-select"),x=r("el-dialog"),f=E("has");return d(),g("div",O,[_("div",B,[s(F,{ref:"form",inline:!0,model:l.queryForm},{default:o(()=>[s(m,{label:"部门名称",prop:"deptName"},{default:o(()=>[s(h,{placeholder:"请输入部门名称",modelValue:l.queryForm.deptName,"onUpdate:modelValue":t[0]||(t[0]=e=>l.queryForm.deptName=e)},null,8,["modelValue"])]),_:1}),s(m,null,{default:o(()=>[s(i,{onClick:n.getDeptList,type:"primary"},{default:o(()=>[u("查询")]),_:1},8,["onClick"]),s(i,{onClick:t[1]||(t[1]=e=>n.handleReset("form"))},{default:o(()=>[u("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",S,[_("div",T,[b((d(),c(i,{type:"primary",onClick:n.handleOpen},{default:o(()=>[u("创建")]),_:1},8,["onClick"])),[[f,"dept-create"]])]),s(w,{data:l.deptList,"row-key":"_id","tree-props":{children:"children"},stripe:""},{default:o(()=>[(d(!0),g(v,null,C(l.columns,e=>(d(),c(k,I({key:e.prop},e),null,16))),128)),s(k,{label:"操作"},{default:o(e=>[b((d(),c(i,{type:"text",size:"small",onClick:U=>n.handleEdit(e.row)},{default:o(()=>[u("编辑")]),_:2},1032,["onClick"])),[[f,"dept-edit"]]),b((d(),c(i,{type:"text",size:"small",onClick:U=>n.handleDel(e.row._id)},{default:o(()=>[u("删除")]),_:2},1032,["onClick"])),[[f,"dept-delete"]])]),_:1})]),_:1},8,["data"])]),s(x,{title:l.action=="create"?"创建部门":"编辑部门",modelValue:l.showModal,"onUpdate:modelValue":t[6]||(t[6]=e=>l.showModal=e)},{footer:o(()=>[_("span",z,[s(i,{onClick:n.handleClose},{default:o(()=>[u("取消")]),_:1},8,["onClick"]),s(i,{onClick:n.handleSubmit,type:"primary"},{default:o(()=>[u("确定")]),_:1},8,["onClick"])])]),default:o(()=>[s(F,{ref:"dialogForm",model:l.deptForm,rules:l.rules,"label-width":"120px"},{default:o(()=>[s(m,{label:"上级部门",prop:"parentId"},{default:o(()=>[s(N,{placeholder:"请选择上级部门",modelValue:l.deptForm.parentId,"onUpdate:modelValue":t[2]||(t[2]=e=>l.deptForm.parentId=e),props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:"",options:l.deptList,"show-all-levels":!0},null,8,["modelValue","options"])]),_:1}),s(m,{label:"部门名称",prop:"deptName"},{default:o(()=>[s(h,{placeholder:"请输入部门名称",modelValue:l.deptForm.deptName,"onUpdate:modelValue":t[3]||(t[3]=e=>l.deptForm.deptName=e)},null,8,["modelValue"])]),_:1}),s(m,{label:"负责人",prop:"user"},{default:o(()=>[s(D,{placeholder:"请选择部门负责人",modelValue:l.deptForm.user,"onUpdate:modelValue":t[4]||(t[4]=e=>l.deptForm.user=e),onChange:n.handleUser},{default:o(()=>[(d(!0),g(v,null,C(l.userList,e=>(d(),c(L,{key:e.userId,label:e.userName,value:`${e.userId}/${e.userName}/${e.userEmail}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),s(m,{label:"负责人邮箱",prop:"userEmail"},{default:o(()=>[s(h,{placeholder:"请输入负责人邮箱",modelValue:l.deptForm.userEmail,"onUpdate:modelValue":t[5]||(t[5]=e=>l.deptForm.userEmail=e),disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}const j=q(M,[["render",A]]);export{j as default};
